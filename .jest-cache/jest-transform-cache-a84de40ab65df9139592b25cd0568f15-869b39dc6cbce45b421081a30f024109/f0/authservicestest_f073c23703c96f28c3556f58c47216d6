b44c6176c8e4f2c605d51f55abb59cde
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const globals_1 = require("@jest/globals");
// Mock the actual auth service module
globals_1.jest.mock('@/lib/services/auth/auth', () => ({
    hashPassword: globals_1.jest.fn(),
    createUser: globals_1.jest.fn(),
    verifyCredentials: globals_1.jest.fn(),
    createSession: globals_1.jest.fn(),
    signOut: globals_1.jest.fn(),
    requireAuth: globals_1.jest.fn(),
    requireAdmin: globals_1.jest.fn(),
    getSessionUser: globals_1.jest.fn()
}));
// Mock database service
globals_1.jest.mock('@/lib/services/database/db', () => ({
    databaseService: {
        execute: globals_1.jest.fn(),
        queryOne: globals_1.jest.fn(),
        queryAll: globals_1.jest.fn()
    },
    generateId: globals_1.jest.fn().mockReturnValue('generated-id'),
    getCurrentTimestamp: globals_1.jest.fn().mockReturnValue('2024-01-01T00:00:00.000Z')
}));
// Mock admin service
globals_1.jest.mock('@/lib/services/admin', () => ({
    getAdminPassword: globals_1.jest.fn().mockReturnValue('admin123'),
    isAdminUsingDefaultPassword: globals_1.jest.fn().mockReturnValue(true)
}));
// Mock crypto
globals_1.jest.mock('crypto', () => ({
    createHash: globals_1.jest.fn().mockReturnValue({
        update: globals_1.jest.fn().mockReturnThis(),
        digest: globals_1.jest.fn().mockReturnValue('hashed-password')
    })
}));
const setup_1 = require("./setup");
// Mock the auth service dependencies
const mockDatabase = (0, setup_1.createMockDatabase)();
const mockLogger = setup_1.ServiceTestUtils.createMockLogger();
// Import the mocked modules
const authService = tslib_1.__importStar(require("@/lib/services/auth/auth"));
const db_1 = require("@/lib/services/database/db");
const admin_1 = require("@/lib/services/admin");
const crypto_1 = tslib_1.__importDefault(require("crypto"));
(0, globals_1.describe)('Authentication Services - Direct Function Calls', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.resetAllMocks();
    });
    (0, globals_1.describe)('Password Hashing Functions', () => {
        (0, globals_1.test)('hashPassword should create SHA256 hash', () => {
            const mockHash = {
                update: globals_1.jest.fn().mockReturnThis(),
                digest: globals_1.jest.fn().mockReturnValue('hashed-password-123')
            };
            crypto_1.default.createHash.mockReturnValue(mockHash);
            // Test the actual implementation
            const password = 'testpassword123';
            const result = authService.hashPassword(password);
            (0, globals_1.expect)(crypto_1.default.createHash).toHaveBeenCalledWith('sha256');
            (0, globals_1.expect)(mockHash.update).toHaveBeenCalledWith(password);
            (0, globals_1.expect)(mockHash.digest).toHaveBeenCalledWith('hex');
            (0, globals_1.expect)(result).toBe('hashed-password-123');
        });
        (0, globals_1.test)('hashPassword should handle empty password', () => {
            const mockHash = {
                update: globals_1.jest.fn().mockReturnThis(),
                digest: globals_1.jest.fn().mockReturnValue('empty-hash')
            };
            crypto_1.default.createHash.mockReturnValue(mockHash);
            const result = authService.hashPassword('');
            (0, globals_1.expect)(mockHash.update).toHaveBeenCalledWith('');
            (0, globals_1.expect)(result).toBe('empty-hash');
        });
        (0, globals_1.test)('hashPassword should handle special characters', () => {
            const mockHash = {
                update: globals_1.jest.fn().mockReturnThis(),
                digest: globals_1.jest.fn().mockReturnValue('special-hash')
            };
            crypto_1.default.createHash.mockReturnValue(mockHash);
            const specialPassword = 'p@ssw0rd!@#$%^&*()';
            const result = authService.hashPassword(specialPassword);
            (0, globals_1.expect)(mockHash.update).toHaveBeenCalledWith(specialPassword);
            (0, globals_1.expect)(result).toBe('special-hash');
        });
        (0, globals_1.test)('hashPassword should produce consistent results', () => {
            const mockHash = {
                update: globals_1.jest.fn().mockReturnThis(),
                digest: globals_1.jest.fn().mockReturnValue('consistent-hash')
            };
            crypto_1.default.createHash.mockReturnValue(mockHash);
            const password = 'samepassword';
            const result1 = authService.hashPassword(password);
            const result2 = authService.hashPassword(password);
            (0, globals_1.expect)(result1).toBe(result2);
            (0, globals_1.expect)(result1).toBe('consistent-hash');
        });
    });
    (0, globals_1.describe)('User Creation Functions', () => {
        (0, globals_1.test)('createUser should create user with hashed password', async () => {
            const mockUser = (0, setup_1.createMockUser)({
                id: 'generated-id',
                username: 'newuser',
                password_hash: 'hashed-password'
            });
            db_1.databaseService.execute.mockResolvedValue(undefined);
            db_1.generateId.mockReturnValue('generated-id');
            db_1.getCurrentTimestamp.mockReturnValue('2024-01-01T00:00:00.000Z');
            authService.hashPassword.mockReturnValue('hashed-password');
            const result = await authService.createUser('newuser', 'plainpassword');
            (0, globals_1.expect)(db_1.generateId).toHaveBeenCalled();
            (0, globals_1.expect)(authService.hashPassword).toHaveBeenCalledWith('plainpassword');
            (0, globals_1.expect)(db_1.getCurrentTimestamp).toHaveBeenCalled();
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith(globals_1.expect.stringContaining('INSERT INTO users'), ['generated-id', 'newuser', 'hashed-password', '2024-01-01T00:00:00.000Z', '2024-01-01T00:00:00.000Z'], 'createUser');
            (0, globals_1.expect)(result).toEqual({
                id: 'generated-id',
                username: 'newuser'
            });
        });
        (0, globals_1.test)('createUser should handle database errors', async () => {
            const dbError = new Error('Database connection failed');
            db_1.databaseService.execute.mockRejectedValue(dbError);
            authService.hashPassword.mockReturnValue('hashed-password');
            await (0, setup_1.expectToThrow)(() => authService.createUser('testuser', 'password'), 'Database connection failed');
        });
        (0, globals_1.test)('createUser should handle duplicate username', async () => {
            const duplicateError = new Error('UNIQUE constraint failed: users.username');
            db_1.databaseService.execute.mockRejectedValue(duplicateError);
            authService.hashPassword.mockReturnValue('hashed-password');
            await (0, setup_1.expectToThrow)(() => authService.createUser('existinguser', 'password'), 'UNIQUE constraint failed');
        });
        (0, globals_1.test)('createUser should validate input parameters', async () => {
            ;
            authService.hashPassword.mockReturnValue('hashed-password');
            // Test with empty username
            await (0, setup_1.expectToThrow)(() => authService.createUser('', 'password'));
            // Test with empty password
            await (0, setup_1.expectToThrow)(() => authService.createUser('username', ''));
        });
    });
    (0, globals_1.describe)('Credential Verification Functions', () => {
        (0, globals_1.test)('verifyCredentials should validate admin with correct password', async () => {
            const mockUser = (0, setup_1.createMockUser)({
                id: 'admin-id',
                username: 'admin',
                password_hash: 'hashed-admin-password'
            });
            db_1.databaseService.queryOne.mockResolvedValue(mockUser);
            authService.hashPassword.mockReturnValue('hashed-admin-password');
            admin_1.isAdminUsingDefaultPassword.mockReturnValue(false);
            const result = await authService.verifyCredentials('admin-password');
            (0, globals_1.expect)(db_1.databaseService.queryOne).toHaveBeenCalledWith(globals_1.expect.stringContaining('SELECT id, username, password_hash FROM users WHERE username = \'admin\''), [], 'verifyCredentials');
            (0, globals_1.expect)(authService.hashPassword).toHaveBeenCalledWith('admin-password');
            (0, globals_1.expect)(result).toEqual({
                id: 'admin-id',
                username: 'admin'
            });
        });
        (0, globals_1.test)('verifyCredentials should handle admin default password', async () => {
            const mockUser = (0, setup_1.createMockUser)({
                id: 'admin-id',
                username: 'admin',
                password_hash: 'old-hash'
            });
            db_1.databaseService.queryOne.mockResolvedValue(mockUser);
            admin_1.isAdminUsingDefaultPassword.mockReturnValue(true);
            admin_1.getAdminPassword.mockReturnValue('default-admin-password');
            const result = await authService.verifyCredentials('default-admin-password');
            (0, globals_1.expect)(result).toEqual({
                id: 'admin-id',
                username: 'admin'
            });
        });
        (0, globals_1.test)('verifyCredentials should return null for invalid password', async () => {
            const mockUser = (0, setup_1.createMockUser)({
                password_hash: 'correct-hash'
            });
            db_1.databaseService.queryOne.mockResolvedValue(mockUser);
            authService.hashPassword.mockReturnValue('wrong-hash');
            admin_1.isAdminUsingDefaultPassword.mockReturnValue(false);
            const result = await authService.verifyCredentials('wrong-password');
            (0, globals_1.expect)(result).toBeNull();
        });
        (0, globals_1.test)('verifyCredentials should return null for non-existent user', async () => {
            ;
            db_1.databaseService.queryOne.mockResolvedValue(null);
            const result = await authService.verifyCredentials('any-password');
            (0, globals_1.expect)(result).toBeNull();
        });
        (0, globals_1.test)('verifyCredentials should handle database errors gracefully', async () => {
            ;
            db_1.databaseService.queryOne.mockRejectedValue(new Error('Database error'));
            const result = await authService.verifyCredentials('password');
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)('Session Management Functions', () => {
        (0, globals_1.test)('createSession should create new session with expiration', async () => {
            const userId = 'test-user-id';
            const sessionId = 'generated-session-id';
            const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();
            db_1.generateId.mockReturnValue(sessionId);
            db_1.databaseService.execute.mockResolvedValue(undefined);
            // Mock Date.now for consistent expiration time
            const mockNow = 1640995200000; // 2022-01-01T00:00:00.000Z
            globals_1.jest.spyOn(Date, 'now').mockReturnValue(mockNow);
            const result = await authService.createSession(userId);
            (0, globals_1.expect)(db_1.generateId).toHaveBeenCalled();
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith('INSERT INTO sessions (id, user_id, expires_at) VALUES (?, ?, ?)', [sessionId, userId, globals_1.expect.any(String)], 'createSession');
            (0, globals_1.expect)(result).toBe(sessionId);
            // Restore Date.now
            globals_1.jest.restoreAllMocks();
        });
        (0, globals_1.test)('createSession should handle database errors', async () => {
            const dbError = new Error('Session creation failed');
            db_1.databaseService.execute.mockRejectedValue(dbError);
            await (0, setup_1.expectToThrow)(() => authService.createSession('user-id'), 'Session creation failed');
        });
        (0, globals_1.test)('createSession should validate user ID', async () => {
            await (0, setup_1.expectToThrow)(() => authService.createSession(''));
            await (0, setup_1.expectToThrow)(() => authService.createSession(null));
        });
        (0, globals_1.test)('createSession should set correct expiration time', async () => {
            const userId = 'test-user-id';
            const mockNow = 1640995200000; // 2022-01-01T00:00:00.000Z
            const expectedExpiration = new Date(mockNow + 7 * 24 * 60 * 60 * 1000).toISOString();
            globals_1.jest.spyOn(Date, 'now').mockReturnValue(mockNow);
            db_1.generateId.mockReturnValue('session-id');
            db_1.databaseService.execute.mockResolvedValue(undefined);
            await authService.createSession(userId);
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith(globals_1.expect.any(String), globals_1.expect.arrayContaining([globals_1.expect.any(String), userId, expectedExpiration]), 'createSession');
            globals_1.jest.restoreAllMocks();
        });
    });
    (0, globals_1.describe)('Session Validation Functions', () => {
        (0, globals_1.test)('requireAuth should return user session for valid session', async () => {
            const mockSession = {
                session_id: 'valid-session',
                user_id: 'user-123',
                expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                username: 'testuser',
                bio: 'Test bio',
                language: 'en',
                theme: 'dark',
                avatar: 'avatar.jpg'
            };
            // Mock cookies
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'valid-session' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(mockSession);
            const result = await authService.requireAuth();
            (0, globals_1.expect)(result).toEqual({
                id: 'user-123',
                username: 'testuser',
                bio: 'Test bio',
                language: 'en',
                theme: 'dark',
                avatar: 'avatar.jpg',
                isAdmin: false
            });
        });
        (0, globals_1.test)('requireAuth should throw error for missing session', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue(undefined)
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            await (0, setup_1.expectToThrow)(() => authService.requireAuth(), 'Non authentifié');
        });
        (0, globals_1.test)('requireAuth should throw error for expired session', async () => {
            const expiredSession = {
                session_id: 'expired-session',
                user_id: 'user-123',
                expires_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // Expired
                username: 'testuser'
            };
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'expired-session' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(expiredSession);
            db_1.databaseService.execute.mockResolvedValue(undefined);
            await (0, setup_1.expectToThrow)(() => authService.requireAuth(), 'Session expirée');
            // Verify expired session is cleaned up
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith('DELETE FROM sessions WHERE id = ?', ['expired-session'], 'requireAuth-cleanup');
        });
        (0, globals_1.test)('requireAuth should handle invalid session', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'invalid-session' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(null);
            await (0, setup_1.expectToThrow)(() => authService.requireAuth(), 'Session invalide');
        });
        (0, globals_1.test)('requireAuth should identify admin users', async () => {
            const adminSession = {
                session_id: 'admin-session',
                user_id: 'admin-123',
                expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                username: 'admin',
                bio: '',
                language: 'fr',
                theme: 'system',
                avatar: ''
            };
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'admin-session' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(adminSession);
            const result = await authService.requireAuth();
            (0, globals_1.expect)(result.isAdmin).toBe(true);
            (0, globals_1.expect)(result.username).toBe('admin');
        });
    });
    (0, globals_1.describe)('Admin Authorization Functions', () => {
        (0, globals_1.test)('requireAdmin should succeed for admin user', async () => {
            const adminUser = {
                id: 'admin-123',
                username: 'admin',
                bio: '',
                language: 'fr',
                theme: 'system',
                avatar: '',
                isAdmin: true
            };
            authService.requireAuth.mockResolvedValue(adminUser);
            await (0, setup_1.expectToResolve)(() => authService.requireAdmin());
        });
        (0, globals_1.test)('requireAdmin should throw error for non-admin user', async () => {
            const regularUser = {
                id: 'user-123',
                username: 'user',
                bio: '',
                language: 'fr',
                theme: 'system',
                avatar: '',
                isAdmin: false
            };
            authService.requireAuth.mockResolvedValue(regularUser);
            await (0, setup_1.expectToThrow)(() => authService.requireAdmin(), 'Non autorisé');
        });
        (0, globals_1.test)('requireAdmin should handle authentication failure', async () => {
            ;
            authService.requireAuth.mockRejectedValue(new Error('Non authentifié'));
            await (0, setup_1.expectToThrow)(() => authService.requireAdmin(), 'Non authentifié');
        });
    });
    (0, globals_1.describe)('Session Cleanup Functions', () => {
        (0, globals_1.test)('signOut should delete session and clear cookie', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'session-to-delete' }),
                delete: globals_1.jest.fn()
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.execute.mockResolvedValue(undefined);
            await authService.signOut();
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith('DELETE FROM sessions WHERE id = ?', ['session-to-delete'], 'signOut');
            (0, globals_1.expect)(mockCookies.delete).toHaveBeenCalledWith('session_id');
        });
        (0, globals_1.test)('signOut should handle missing session gracefully', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue(undefined),
                delete: globals_1.jest.fn()
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            await (0, setup_1.expectToResolve)(() => authService.signOut());
            (0, globals_1.expect)(db_1.databaseService.execute).not.toHaveBeenCalled();
            (0, globals_1.expect)(mockCookies.delete).not.toHaveBeenCalled();
        });
        (0, globals_1.test)('signOut should handle database errors', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'session-id' }),
                delete: globals_1.jest.fn()
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.execute.mockRejectedValue(new Error('Database error'));
            // Should not throw, but handle gracefully
            await (0, setup_1.expectToResolve)(() => authService.signOut());
        });
    });
    (0, globals_1.describe)('User Session Retrieval Functions', () => {
        (0, globals_1.test)('getSessionUser should return user for valid session', async () => {
            const mockSession = {
                session_id: 'valid-session',
                user_id: 'user-123',
                expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                username: 'testuser',
                bio: 'Test bio',
                language: 'en',
                theme: 'dark',
                avatar: 'avatar.jpg'
            };
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'valid-session' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(mockSession);
            const result = await authService.getSessionUser();
            (0, globals_1.expect)(result).toEqual({
                id: 'user-123',
                username: 'testuser',
                bio: 'Test bio',
                language: 'en',
                theme: 'dark',
                avatar: 'avatar.jpg',
                isAdmin: false
            });
        });
        (0, globals_1.test)('getSessionUser should return null for missing session', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue(undefined)
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            const result = await authService.getSessionUser();
            (0, globals_1.expect)(result).toBeNull();
        });
        (0, globals_1.test)('getSessionUser should return null for expired session', async () => {
            const expiredSession = {
                session_id: 'expired-session',
                user_id: 'user-123',
                expires_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                username: 'testuser'
            };
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'expired-session' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(expiredSession);
            db_1.databaseService.execute.mockResolvedValue(undefined);
            const result = await authService.getSessionUser();
            (0, globals_1.expect)(result).toBeNull();
            // Verify cleanup
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith('DELETE FROM sessions WHERE id = ?', ['expired-session'], 'getSessionUser-cleanup');
        });
        (0, globals_1.test)('getSessionUser should handle database errors gracefully', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'session-id' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockRejectedValue(new Error('Database error'));
            const result = await authService.getSessionUser();
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)('Audit Logging and User Action Tracking', () => {
        (0, globals_1.test)('should log user creation events', async () => {
            ;
            db_1.databaseService.execute.mockResolvedValue(undefined);
            authService.hashPassword.mockReturnValue('hashed-password');
            await authService.createUser('newuser', 'password');
            // Verify logging calls were made (implementation depends on logging setup)
            (0, globals_1.expect)(mockLogger.info).toHaveBeenCalled();
        });
        (0, globals_1.test)('should log authentication attempts', async () => {
            const mockUser = (0, setup_1.createMockUser)();
            db_1.databaseService.queryOne.mockResolvedValue(mockUser);
            authService.hashPassword.mockReturnValue(mockUser.password_hash);
            await authService.verifyCredentials('password');
            // Verify authentication logging
            (0, globals_1.expect)(mockLogger.info).toHaveBeenCalled();
        });
        (0, globals_1.test)('should log failed authentication attempts', async () => {
            ;
            db_1.databaseService.queryOne.mockResolvedValue(null);
            await authService.verifyCredentials('wrong-password');
            // Verify failed authentication logging
            (0, globals_1.expect)(mockLogger.warn).toHaveBeenCalled();
        });
        (0, globals_1.test)('should log session creation and destruction', async () => {
            ;
            db_1.databaseService.execute.mockResolvedValue(undefined);
            await authService.createSession('user-id');
            // Verify session creation logging
            (0, globals_1.expect)(mockLogger.info).toHaveBeenCalled();
        });
        (0, globals_1.test)('should track user actions with context', async () => {
            const mockSession = {
                session_id: 'session-123',
                user_id: 'user-123',
                expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                username: 'testuser'
            };
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'session-123' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(mockSession);
            await authService.requireAuth();
            // Verify user action tracking includes context
            (0, globals_1.expect)(db_1.databaseService.queryOne).toHaveBeenCalledWith(globals_1.expect.stringContaining('sessions'), ['session-123'], 'requireAuth');
        });
    });
    (0, globals_1.describe)('Error Handling and Edge Cases', () => {
        (0, globals_1.test)('should handle malformed session data', async () => {
            const malformedSession = {
                session_id: 'session-123',
                user_id: 'user-123',
                expires_at: 'invalid-date',
                username: 'testuser'
            };
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: 'session-123' })
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            db_1.databaseService.queryOne.mockResolvedValue(malformedSession);
            db_1.databaseService.execute.mockResolvedValue(undefined);
            await (0, setup_1.expectToThrow)(() => authService.requireAuth(), 'Session invalide');
            // Verify cleanup of malformed session
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledWith('DELETE FROM sessions WHERE id = ?', ['session-123'], 'requireAuth-cleanup');
        });
        (0, globals_1.test)('should handle concurrent session operations', async () => {
            const userId = 'user-123';
            db_1.generateId
                .mockReturnValueOnce('session-1')
                .mockReturnValueOnce('session-2')
                .mockReturnValueOnce('session-3');
            db_1.databaseService.execute.mockResolvedValue(undefined);
            // Create multiple sessions concurrently
            const sessionPromises = [
                authService.createSession(userId),
                authService.createSession(userId),
                authService.createSession(userId)
            ];
            const results = await Promise.all(sessionPromises);
            (0, globals_1.expect)(results).toEqual(['session-1', 'session-2', 'session-3']);
            (0, globals_1.expect)(db_1.databaseService.execute).toHaveBeenCalledTimes(3);
        });
        (0, globals_1.test)('should handle database connection failures gracefully', async () => {
            const connectionError = new Error('SQLITE_BUSY: database is locked');
            db_1.databaseService.queryOne.mockRejectedValue(connectionError);
            const result = await authService.verifyCredentials('password');
            (0, globals_1.expect)(result).toBeNull();
        });
        (0, globals_1.test)('should validate session cookie format', async () => {
            const mockCookies = {
                get: globals_1.jest.fn().mockReturnValue({ value: '   ' }) // Whitespace only
            };
            globals_1.jest.doMock('next/headers', () => ({
                cookies: () => mockCookies
            }));
            await (0, setup_1.expectToThrow)(() => authService.requireAuth(), 'Non authentifié');
        });
        (0, globals_1.test)('should handle null/undefined user data gracefully', async () => {
            await (0, setup_1.expectToThrow)(() => authService.createUser(null, 'password'));
            await (0, setup_1.expectToThrow)(() => authService.createUser('username', null));
            await (0, setup_1.expectToThrow)(() => authService.createSession(null));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRjpcXFlvdWNsb3VkXFxEb2N1bWVudHNcXFByb2pldHNcXExvZ2lzdGl4XFx0ZXN0c1xcYmFja2VuZFxcYXV0aC1zZXJ2aWNlcy50ZXN0LnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLDJDQUFtRjtBQWVuRixzQ0FBc0M7QUFDdEMsY0FBSSxDQUFDLElBQUksQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLFlBQVksRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3ZCLFVBQVUsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3JCLGlCQUFpQixFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDNUIsYUFBYSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDeEIsT0FBTyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsV0FBVyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdEIsWUFBWSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdkIsY0FBYyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDMUIsQ0FBQyxDQUFDLENBQUE7QUFFSCx3QkFBd0I7QUFDeEIsY0FBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLGVBQWUsRUFBRTtRQUNmLE9BQU8sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLFFBQVEsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ25CLFFBQVEsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3BCO0lBQ0QsVUFBVSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDO0lBQ3JELG1CQUFtQixFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsMEJBQTBCLENBQUM7Q0FDM0UsQ0FBQyxDQUFDLENBQUE7QUFFSCxxQkFBcUI7QUFDckIsY0FBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxHQUFH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QSxxQkFBYSxFQUNqQixHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxJQUFXLENBQUMsQ0FDdEQsQ0FBQTtZQUVELE1BQU0sSUFBQSxxQkFBYSxFQUNqQixHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLElBQVcsQ0FBQyxDQUM3QyxDQUFBO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkY6XFxZb3VjbG91ZFxcRG9jdW1lbnRzXFxQcm9qZXRzXFxMb2dpc3RpeFxcdGVzdHNcXGJhY2tlbmRcXGF1dGgtc2VydmljZXMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgdGVzdCwgZXhwZWN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2gsIGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJ1xyXG5pbXBvcnQge1xyXG4gIGNyZWF0ZU1vY2tEYXRhYmFzZSxcclxuICBjcmVhdGVNb2NrVXNlcixcclxuICBjcmVhdGVNb2NrU2Vzc2lvbixcclxuICBTZXJ2aWNlVGVzdFV0aWxzLFxyXG4gIGV4cGVjdFRvVGhyb3csXHJcbiAgZXhwZWN0VG9SZXNvbHZlLFxyXG4gIHdhaXRGb3JQcm9taXNlc1xyXG59IGZyb20gJy4vc2V0dXAnXHJcblxyXG4vLyBNb2NrIHRoZSBhdXRoIHNlcnZpY2UgZGVwZW5kZW5jaWVzXHJcbmNvbnN0IG1vY2tEYXRhYmFzZSA9IGNyZWF0ZU1vY2tEYXRhYmFzZSgpXHJcbmNvbnN0IG1vY2tMb2dnZXIgPSBTZXJ2aWNlVGVzdFV0aWxzLmNyZWF0ZU1vY2tMb2dnZXIoKVxyXG5cclxuLy8gTW9jayB0aGUgYWN0dWFsIGF1dGggc2VydmljZSBtb2R1bGVcclxuamVzdC5tb2NrKCdAL2xpYi9zZXJ2aWNlcy9hdXRoL2F1dGgnLCAoKSA9PiAoe1xyXG4gIGhhc2hQYXNzd29yZDogamVzdC5mbigpLFxyXG4gIGNyZWF0ZVVzZXI6IGplc3QuZm4oKSxcclxuICB2ZXJpZnlDcmVkZW50aWFsczogamVzdC5mbigpLFxyXG4gIGNyZWF0ZVNlc3Npb246IGplc3QuZm4oKSxcclxuICBzaWduT3V0OiBqZXN0LmZuKCksXHJcbiAgcmVxdWlyZUF1dGg6IGplc3QuZm4oKSxcclxuICByZXF1aXJlQWRtaW46IGplc3QuZm4oKSxcclxuICBnZXRTZXNzaW9uVXNlcjogamVzdC5mbigpXHJcbn0pKVxyXG5cclxuLy8gTW9jayBkYXRhYmFzZSBzZXJ2aWNlXHJcbmplc3QubW9jaygnQC9saWIvc2VydmljZXMvZGF0YWJhc2UvZGInLCAoKSA9PiAoe1xyXG4gIGRhdGFiYXNlU2VydmljZToge1xyXG4gICAgZXhlY3V0ZTogamVzdC5mbigpLFxyXG4gICAgcXVlcnlPbmU6IGplc3QuZm4oKSxcclxuICAgIHF1ZXJ5QWxsOiBqZXN0LmZuKClcclxuICB9LFxyXG4gIGdlbmVyYXRlSWQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2dlbmVyYXRlZC1pZCcpLFxyXG4gIGdldEN1cnJlbnRUaW1lc3RhbXA6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicpXHJcbn0pKVxyXG5cclxuLy8gTW9jayBhZG1pbiBzZXJ2aWNlXHJcbmplc3QubW9jaygnQC9saWIvc2VydmljZXMvYWRtaW4nLCAoKSA9PiAoe1xyXG4gIGdldEFkbWluUGFzc3dvcmQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2FkbWluMTIzJyksXHJcbiAgaXNBZG1pblVzaW5nRGVmYXVsdFBhc3N3b3JkOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpXHJcbn0pKVxyXG5cclxuLy8gTW9jayBjcnlwdG9cclxuamVzdC5tb2NrKCdjcnlwdG8nLCAoKSA9PiAoe1xyXG4gIGNyZWF0ZUhhc2g6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgIGRpZ2VzdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnaGFzaGVkLXBhc3N3b3JkJylcclxuICB9KVxyXG59KSlcclxuXHJcbi8vIEltcG9ydCB0aGUgbW9ja2VkIG1vZHVsZXNcclxuaW1wb3J0ICogYXMgYXV0aFNlcnZpY2UgZnJvbSAnQC9saWIvc2VydmljZXMvYXV0aC9hdXRoJ1xyXG5pbXBvcnQgeyBkYXRhYmFzZVNlcnZpY2UsIGdlbmVyYXRlSWQsIGdldEN1cnJlbnRUaW1lc3RhbXAgfSBmcm9tICdAL2xpYi9zZXJ2aWNlcy9kYXRhYmFzZS9kYidcclxuaW1wb3J0IHsgZ2V0QWRtaW5QYXNzd29yZCwgaXNBZG1pblVzaW5nRGVmYXVsdFBhc3N3b3JkIH0gZnJvbSAnQC9saWIvc2VydmljZXMvYWRtaW4nXHJcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJ1xyXG5cclxuZGVzY3JpYmUoJ0F1dGhlbnRpY2F0aW9uIFNlcnZpY2VzIC0gRGlyZWN0IEZ1bmN0aW9uIENhbGxzJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKClcclxuICB9KVxyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5yZXNldEFsbE1vY2tzKClcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgnUGFzc3dvcmQgSGFzaGluZyBGdW5jdGlvbnMnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdoYXNoUGFzc3dvcmQgc2hvdWxkIGNyZWF0ZSBTSEEyNTYgaGFzaCcsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0hhc2ggPSB7XHJcbiAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgICBkaWdlc3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2hhc2hlZC1wYXNzd29yZC0xMjMnKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICA7KGNyeXB0by5jcmVhdGVIYXNoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tIYXNoKVxyXG4gICAgICBcclxuICAgICAgLy8gVGVzdCB0aGUgYWN0dWFsIGltcGxlbWVudGF0aW9uXHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gJ3Rlc3RwYXNzd29yZDEyMydcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkKHBhc3N3b3JkKVxyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGNyeXB0by5jcmVhdGVIYXNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc2hhMjU2JylcclxuICAgICAgZXhwZWN0KG1vY2tIYXNoLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgocGFzc3dvcmQpXHJcbiAgICAgIGV4cGVjdChtb2NrSGFzaC5kaWdlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdoZXgnKVxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdoYXNoZWQtcGFzc3dvcmQtMTIzJylcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnaGFzaFBhc3N3b3JkIHNob3VsZCBoYW5kbGUgZW1wdHkgcGFzc3dvcmQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tIYXNoID0ge1xyXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgICAgZGlnZXN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdlbXB0eS1oYXNoJylcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgOyhjcnlwdG8uY3JlYXRlSGFzaCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShtb2NrSGFzaClcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF1dGhTZXJ2aWNlLmhhc2hQYXNzd29yZCgnJylcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrSGFzaC51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcnKVxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdlbXB0eS1oYXNoJylcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnaGFzaFBhc3N3b3JkIHNob3VsZCBoYW5kbGUgc3BlY2lhbCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrSGFzaCA9IHtcclxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICAgIGRpZ2VzdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnc3BlY2lhbC1oYXNoJylcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgOyhjcnlwdG8uY3JlYXRlSGFzaCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShtb2NrSGFzaClcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHNwZWNpYWxQYXNzd29yZCA9ICdwQHNzdzByZCFAIyQlXiYqKCknXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF1dGhTZXJ2aWNlLmhhc2hQYXNzd29yZChzcGVjaWFsUGFzc3dvcmQpXHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QobW9ja0hhc2gudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChzcGVjaWFsUGFzc3dvcmQpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3NwZWNpYWwtaGFzaCcpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ2hhc2hQYXNzd29yZCBzaG91bGQgcHJvZHVjZSBjb25zaXN0ZW50IHJlc3VsdHMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tIYXNoID0ge1xyXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgICAgZGlnZXN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdjb25zaXN0ZW50LWhhc2gnKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICA7KGNyeXB0by5jcmVhdGVIYXNoIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tIYXNoKVxyXG4gICAgICBcclxuICAgICAgY29uc3QgcGFzc3dvcmQgPSAnc2FtZXBhc3N3b3JkJ1xyXG4gICAgICBjb25zdCByZXN1bHQxID0gYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkKHBhc3N3b3JkKVxyXG4gICAgICBjb25zdCByZXN1bHQyID0gYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkKHBhc3N3b3JkKVxyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdDEpLnRvQmUocmVzdWx0MilcclxuICAgICAgZXhwZWN0KHJlc3VsdDEpLnRvQmUoJ2NvbnNpc3RlbnQtaGFzaCcpXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKCdVc2VyIENyZWF0aW9uIEZ1bmN0aW9ucycsICgpID0+IHtcclxuICAgIHRlc3QoJ2NyZWF0ZVVzZXIgc2hvdWxkIGNyZWF0ZSB1c2VyIHdpdGggaGFzaGVkIHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrVXNlciA9IGNyZWF0ZU1vY2tVc2VyKHtcclxuICAgICAgICBpZDogJ2dlbmVyYXRlZC1pZCcsXHJcbiAgICAgICAgdXNlcm5hbWU6ICduZXd1c2VyJyxcclxuICAgICAgICBwYXNzd29yZF9oYXNoOiAnaGFzaGVkLXBhc3N3b3JkJ1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcclxuICAgICAgOyhnZW5lcmF0ZUlkIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKCdnZW5lcmF0ZWQtaWQnKVxyXG4gICAgICA7KGdldEN1cnJlbnRUaW1lc3RhbXAgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicpXHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIGhhc2hQYXNzd29yZCBpbXBsZW1lbnRhdGlvblxyXG4gICAgICA7KGF1dGhTZXJ2aWNlLmhhc2hQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSgnaGFzaGVkLXBhc3N3b3JkJylcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLmNyZWF0ZVVzZXIoJ25ld3VzZXInLCAncGxhaW5wYXNzd29yZCcpXHJcblxyXG4gICAgICBleHBlY3QoZ2VuZXJhdGVJZCkudG9IYXZlQmVlbkNhbGxlZCgpXHJcbiAgICAgIGV4cGVjdChhdXRoU2VydmljZS5oYXNoUGFzc3dvcmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwbGFpbnBhc3N3b3JkJylcclxuICAgICAgZXhwZWN0KGdldEN1cnJlbnRUaW1lc3RhbXApLnRvSGF2ZUJlZW5DYWxsZWQoKVxyXG4gICAgICBleHBlY3QoZGF0YWJhc2VTZXJ2aWNlLmV4ZWN1dGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdJTlNFUlQgSU5UTyB1c2VycycpLFxyXG4gICAgICAgIFsnZ2VuZXJhdGVkLWlkJywgJ25ld3VzZXInLCAnaGFzaGVkLXBhc3N3b3JkJywgJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicsICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonXSxcclxuICAgICAgICAnY3JlYXRlVXNlcidcclxuICAgICAgKVxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcclxuICAgICAgICBpZDogJ2dlbmVyYXRlZC1pZCcsXHJcbiAgICAgICAgdXNlcm5hbWU6ICduZXd1c2VyJ1xyXG4gICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdjcmVhdGVVc2VyIHNob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkYkVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLmV4ZWN1dGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKVxyXG4gICAgICA7KGF1dGhTZXJ2aWNlLmhhc2hQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSgnaGFzaGVkLXBhc3N3b3JkJylcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UuY3JlYXRlVXNlcigndGVzdHVzZXInLCAncGFzc3dvcmQnKSxcclxuICAgICAgICAnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnY3JlYXRlVXNlciBzaG91bGQgaGFuZGxlIGR1cGxpY2F0ZSB1c2VybmFtZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZHVwbGljYXRlRXJyb3IgPSBuZXcgRXJyb3IoJ1VOSVFVRSBjb25zdHJhaW50IGZhaWxlZDogdXNlcnMudXNlcm5hbWUnKVxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5leGVjdXRlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoZHVwbGljYXRlRXJyb3IpXHJcbiAgICAgIDsoYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKCdoYXNoZWQtcGFzc3dvcmQnKVxyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0VG9UaHJvdyhcclxuICAgICAgICAoKSA9PiBhdXRoU2VydmljZS5jcmVhdGVVc2VyKCdleGlzdGluZ3VzZXInLCAncGFzc3dvcmQnKSxcclxuICAgICAgICAnVU5JUVVFIGNvbnN0cmFpbnQgZmFpbGVkJ1xyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ2NyZWF0ZVVzZXIgc2hvdWxkIHZhbGlkYXRlIGlucHV0IHBhcmFtZXRlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIDsoYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKCdoYXNoZWQtcGFzc3dvcmQnKVxyXG5cclxuICAgICAgLy8gVGVzdCB3aXRoIGVtcHR5IHVzZXJuYW1lXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UuY3JlYXRlVXNlcignJywgJ3Bhc3N3b3JkJylcclxuICAgICAgKVxyXG5cclxuICAgICAgLy8gVGVzdCB3aXRoIGVtcHR5IHBhc3N3b3JkXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UuY3JlYXRlVXNlcigndXNlcm5hbWUnLCAnJylcclxuICAgICAgKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgnQ3JlZGVudGlhbCBWZXJpZmljYXRpb24gRnVuY3Rpb25zJywgKCkgPT4ge1xyXG4gICAgdGVzdCgndmVyaWZ5Q3JlZGVudGlhbHMgc2hvdWxkIHZhbGlkYXRlIGFkbWluIHdpdGggY29ycmVjdCBwYXNzd29yZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1VzZXIgPSBjcmVhdGVNb2NrVXNlcih7XHJcbiAgICAgICAgaWQ6ICdhZG1pbi1pZCcsXHJcbiAgICAgICAgdXNlcm5hbWU6ICdhZG1pbicsXHJcbiAgICAgICAgcGFzc3dvcmRfaGFzaDogJ2hhc2hlZC1hZG1pbi1wYXNzd29yZCdcclxuICAgICAgfSlcclxuXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLnF1ZXJ5T25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpXHJcbiAgICAgIDsoYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKCdoYXNoZWQtYWRtaW4tcGFzc3dvcmQnKVxyXG4gICAgICA7KGlzQWRtaW5Vc2luZ0RlZmF1bHRQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSlcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLnZlcmlmeUNyZWRlbnRpYWxzKCdhZG1pbi1wYXNzd29yZCcpXHJcblxyXG4gICAgICBleHBlY3QoZGF0YWJhc2VTZXJ2aWNlLnF1ZXJ5T25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnU0VMRUNUIGlkLCB1c2VybmFtZSwgcGFzc3dvcmRfaGFzaCBGUk9NIHVzZXJzIFdIRVJFIHVzZXJuYW1lID0gXFwnYWRtaW5cXCcnKSxcclxuICAgICAgICBbXSxcclxuICAgICAgICAndmVyaWZ5Q3JlZGVudGlhbHMnXHJcbiAgICAgIClcclxuICAgICAgZXhwZWN0KGF1dGhTZXJ2aWNlLmhhc2hQYXNzd29yZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FkbWluLXBhc3N3b3JkJylcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XHJcbiAgICAgICAgaWQ6ICdhZG1pbi1pZCcsXHJcbiAgICAgICAgdXNlcm5hbWU6ICdhZG1pbidcclxuICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgndmVyaWZ5Q3JlZGVudGlhbHMgc2hvdWxkIGhhbmRsZSBhZG1pbiBkZWZhdWx0IHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrVXNlciA9IGNyZWF0ZU1vY2tVc2VyKHtcclxuICAgICAgICBpZDogJ2FkbWluLWlkJyxcclxuICAgICAgICB1c2VybmFtZTogJ2FkbWluJyxcclxuICAgICAgICBwYXNzd29yZF9oYXNoOiAnb2xkLWhhc2gnXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKVxyXG4gICAgICA7KGlzQWRtaW5Vc2luZ0RlZmF1bHRQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKVxyXG4gICAgICA7KGdldEFkbWluUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoJ2RlZmF1bHQtYWRtaW4tcGFzc3dvcmQnKVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UudmVyaWZ5Q3JlZGVudGlhbHMoJ2RlZmF1bHQtYWRtaW4tcGFzc3dvcmQnKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XHJcbiAgICAgICAgaWQ6ICdhZG1pbi1pZCcsXHJcbiAgICAgICAgdXNlcm5hbWU6ICdhZG1pbidcclxuICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgndmVyaWZ5Q3JlZGVudGlhbHMgc2hvdWxkIHJldHVybiBudWxsIGZvciBpbnZhbGlkIHBhc3N3b3JkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrVXNlciA9IGNyZWF0ZU1vY2tVc2VyKHtcclxuICAgICAgICBwYXNzd29yZF9oYXNoOiAnY29ycmVjdC1oYXNoJ1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UucXVlcnlPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcclxuICAgICAgOyhhdXRoU2VydmljZS5oYXNoUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoJ3dyb25nLWhhc2gnKVxyXG4gICAgICA7KGlzQWRtaW5Vc2luZ0RlZmF1bHRQYXNzd29yZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSlcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLnZlcmlmeUNyZWRlbnRpYWxzKCd3cm9uZy1wYXNzd29yZCcpXHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ3ZlcmlmeUNyZWRlbnRpYWxzIHNob3VsZCByZXR1cm4gbnVsbCBmb3Igbm9uLWV4aXN0ZW50IHVzZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLnF1ZXJ5T25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbClcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLnZlcmlmeUNyZWRlbnRpYWxzKCdhbnktcGFzc3dvcmQnKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCd2ZXJpZnlDcmVkZW50aWFscyBzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSlcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLnZlcmlmeUNyZWRlbnRpYWxzKCdwYXNzd29yZCcpXHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKCdTZXNzaW9uIE1hbmFnZW1lbnQgRnVuY3Rpb25zJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnY3JlYXRlU2Vzc2lvbiBzaG91bGQgY3JlYXRlIG5ldyBzZXNzaW9uIHdpdGggZXhwaXJhdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3Rlc3QtdXNlci1pZCdcclxuICAgICAgY29uc3Qgc2Vzc2lvbklkID0gJ2dlbmVyYXRlZC1zZXNzaW9uLWlkJ1xyXG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcclxuXHJcbiAgICAgIDsoZ2VuZXJhdGVJZCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShzZXNzaW9uSWQpXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLmV4ZWN1dGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpXHJcblxyXG4gICAgICAvLyBNb2NrIERhdGUubm93IGZvciBjb25zaXN0ZW50IGV4cGlyYXRpb24gdGltZVxyXG4gICAgICBjb25zdCBtb2NrTm93ID0gMTY0MDk5NTIwMDAwMCAvLyAyMDIyLTAxLTAxVDAwOjAwOjAwLjAwMFpcclxuICAgICAgamVzdC5zcHlPbihEYXRlLCAnbm93JykubW9ja1JldHVyblZhbHVlKG1vY2tOb3cpXHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5jcmVhdGVTZXNzaW9uKHVzZXJJZClcclxuXHJcbiAgICAgIGV4cGVjdChnZW5lcmF0ZUlkKS50b0hhdmVCZWVuQ2FsbGVkKClcclxuICAgICAgZXhwZWN0KGRhdGFiYXNlU2VydmljZS5leGVjdXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAnSU5TRVJUIElOVE8gc2Vzc2lvbnMgKGlkLCB1c2VyX2lkLCBleHBpcmVzX2F0KSBWQUxVRVMgKD8sID8sID8pJyxcclxuICAgICAgICBbc2Vzc2lvbklkLCB1c2VySWQsIGV4cGVjdC5hbnkoU3RyaW5nKV0sXHJcbiAgICAgICAgJ2NyZWF0ZVNlc3Npb24nXHJcbiAgICAgIClcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShzZXNzaW9uSWQpXHJcblxyXG4gICAgICAvLyBSZXN0b3JlIERhdGUubm93XHJcbiAgICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnY3JlYXRlU2Vzc2lvbiBzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZGJFcnJvciA9IG5ldyBFcnJvcignU2Vzc2lvbiBjcmVhdGlvbiBmYWlsZWQnKVxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5leGVjdXRlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoZGJFcnJvcilcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UuY3JlYXRlU2Vzc2lvbigndXNlci1pZCcpLFxyXG4gICAgICAgICdTZXNzaW9uIGNyZWF0aW9uIGZhaWxlZCdcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdjcmVhdGVTZXNzaW9uIHNob3VsZCB2YWxpZGF0ZSB1c2VyIElEJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhd2FpdCBleHBlY3RUb1Rocm93KFxyXG4gICAgICAgICgpID0+IGF1dGhTZXJ2aWNlLmNyZWF0ZVNlc3Npb24oJycpXHJcbiAgICAgIClcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UuY3JlYXRlU2Vzc2lvbihudWxsIGFzIGFueSlcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdjcmVhdGVTZXNzaW9uIHNob3VsZCBzZXQgY29ycmVjdCBleHBpcmF0aW9uIHRpbWUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd0ZXN0LXVzZXItaWQnXHJcbiAgICAgIGNvbnN0IG1vY2tOb3cgPSAxNjQwOTk1MjAwMDAwIC8vIDIwMjItMDEtMDFUMDA6MDA6MDAuMDAwWlxyXG4gICAgICBjb25zdCBleHBlY3RlZEV4cGlyYXRpb24gPSBuZXcgRGF0ZShtb2NrTm93ICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKClcclxuXHJcbiAgICAgIGplc3Quc3B5T24oRGF0ZSwgJ25vdycpLm1vY2tSZXR1cm5WYWx1ZShtb2NrTm93KVxyXG4gICAgICA7KGdlbmVyYXRlSWQgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoJ3Nlc3Npb24taWQnKVxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5leGVjdXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKVxyXG5cclxuICAgICAgYXdhaXQgYXV0aFNlcnZpY2UuY3JlYXRlU2Vzc2lvbih1c2VySWQpXHJcblxyXG4gICAgICBleHBlY3QoZGF0YWJhc2VTZXJ2aWNlLmV4ZWN1dGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICBleHBlY3QuYXJyYXlDb250YWluaW5nKFtleHBlY3QuYW55KFN0cmluZyksIHVzZXJJZCwgZXhwZWN0ZWRFeHBpcmF0aW9uXSksXHJcbiAgICAgICAgJ2NyZWF0ZVNlc3Npb24nXHJcbiAgICAgIClcclxuXHJcbiAgICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKClcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoJ1Nlc3Npb24gVmFsaWRhdGlvbiBGdW5jdGlvbnMnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdyZXF1aXJlQXV0aCBzaG91bGQgcmV0dXJuIHVzZXIgc2Vzc2lvbiBmb3IgdmFsaWQgc2Vzc2lvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1Nlc3Npb24gPSB7XHJcbiAgICAgICAgc2Vzc2lvbl9pZDogJ3ZhbGlkLXNlc3Npb24nLFxyXG4gICAgICAgIHVzZXJfaWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgZXhwaXJlc19hdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXHJcbiAgICAgICAgYmlvOiAnVGVzdCBiaW8nLFxyXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLFxyXG4gICAgICAgIHRoZW1lOiAnZGFyaycsXHJcbiAgICAgICAgYXZhdGFyOiAnYXZhdGFyLmpwZydcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTW9jayBjb29raWVzXHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHZhbHVlOiAndmFsaWQtc2Vzc2lvbicgfSlcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgamVzdC5kb01vY2soJ25leHQvaGVhZGVycycsICgpID0+ICh7XHJcbiAgICAgICAgY29va2llczogKCkgPT4gbW9ja0Nvb2tpZXNcclxuICAgICAgfSkpXHJcblxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTZXNzaW9uKVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UucmVxdWlyZUF1dGgoKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XHJcbiAgICAgICAgaWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXHJcbiAgICAgICAgYmlvOiAnVGVzdCBiaW8nLFxyXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLFxyXG4gICAgICAgIHRoZW1lOiAnZGFyaycsXHJcbiAgICAgICAgYXZhdGFyOiAnYXZhdGFyLmpwZycsXHJcbiAgICAgICAgaXNBZG1pbjogZmFsc2VcclxuICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgncmVxdWlyZUF1dGggc2hvdWxkIHRocm93IGVycm9yIGZvciBtaXNzaW5nIHNlc3Npb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh1bmRlZmluZWQpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGplc3QuZG9Nb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xyXG4gICAgICAgIGNvb2tpZXM6ICgpID0+IG1vY2tDb29raWVzXHJcbiAgICAgIH0pKVxyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0VG9UaHJvdyhcclxuICAgICAgICAoKSA9PiBhdXRoU2VydmljZS5yZXF1aXJlQXV0aCgpLFxyXG4gICAgICAgICdOb24gYXV0aGVudGlmacOpJ1xyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ3JlcXVpcmVBdXRoIHNob3VsZCB0aHJvdyBlcnJvciBmb3IgZXhwaXJlZCBzZXNzaW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleHBpcmVkU2Vzc2lvbiA9IHtcclxuICAgICAgICBzZXNzaW9uX2lkOiAnZXhwaXJlZC1zZXNzaW9uJyxcclxuICAgICAgICB1c2VyX2lkOiAndXNlci0xMjMnLFxyXG4gICAgICAgIGV4cGlyZXNfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLCAvLyBFeHBpcmVkXHJcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0dXNlcidcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgbW9ja0Nvb2tpZXMgPSB7XHJcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdmFsdWU6ICdleHBpcmVkLXNlc3Npb24nIH0pXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGplc3QuZG9Nb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xyXG4gICAgICAgIGNvb2tpZXM6ICgpID0+IG1vY2tDb29raWVzXHJcbiAgICAgIH0pKVxyXG5cclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UucXVlcnlPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShleHBpcmVkU2Vzc2lvbilcclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UucmVxdWlyZUF1dGgoKSxcclxuICAgICAgICAnU2Vzc2lvbiBleHBpcsOpZSdcclxuICAgICAgKVxyXG5cclxuICAgICAgLy8gVmVyaWZ5IGV4cGlyZWQgc2Vzc2lvbiBpcyBjbGVhbmVkIHVwXHJcbiAgICAgIGV4cGVjdChkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgJ0RFTEVURSBGUk9NIHNlc3Npb25zIFdIRVJFIGlkID0gPycsXHJcbiAgICAgICAgWydleHBpcmVkLXNlc3Npb24nXSxcclxuICAgICAgICAncmVxdWlyZUF1dGgtY2xlYW51cCdcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdyZXF1aXJlQXV0aCBzaG91bGQgaGFuZGxlIGludmFsaWQgc2Vzc2lvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0Nvb2tpZXMgPSB7XHJcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdmFsdWU6ICdpbnZhbGlkLXNlc3Npb24nIH0pXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGplc3QuZG9Nb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xyXG4gICAgICAgIGNvb2tpZXM6ICgpID0+IG1vY2tDb29raWVzXHJcbiAgICAgIH0pKVxyXG5cclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UucXVlcnlPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKVxyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0VG9UaHJvdyhcclxuICAgICAgICAoKSA9PiBhdXRoU2VydmljZS5yZXF1aXJlQXV0aCgpLFxyXG4gICAgICAgICdTZXNzaW9uIGludmFsaWRlJ1xyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ3JlcXVpcmVBdXRoIHNob3VsZCBpZGVudGlmeSBhZG1pbiB1c2VycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYWRtaW5TZXNzaW9uID0ge1xyXG4gICAgICAgIHNlc3Npb25faWQ6ICdhZG1pbi1zZXNzaW9uJyxcclxuICAgICAgICB1c2VyX2lkOiAnYWRtaW4tMTIzJyxcclxuICAgICAgICBleHBpcmVzX2F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1c2VybmFtZTogJ2FkbWluJyxcclxuICAgICAgICBiaW86ICcnLFxyXG4gICAgICAgIGxhbmd1YWdlOiAnZnInLFxyXG4gICAgICAgIHRoZW1lOiAnc3lzdGVtJyxcclxuICAgICAgICBhdmF0YXI6ICcnXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHZhbHVlOiAnYWRtaW4tc2Vzc2lvbicgfSlcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgamVzdC5kb01vY2soJ25leHQvaGVhZGVycycsICgpID0+ICh7XHJcbiAgICAgICAgY29va2llczogKCkgPT4gbW9ja0Nvb2tpZXNcclxuICAgICAgfSkpXHJcblxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKGFkbWluU2Vzc2lvbilcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLnJlcXVpcmVBdXRoKClcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNBZG1pbikudG9CZSh0cnVlKVxyXG4gICAgICBleHBlY3QocmVzdWx0LnVzZXJuYW1lKS50b0JlKCdhZG1pbicpXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKCdBZG1pbiBBdXRob3JpemF0aW9uIEZ1bmN0aW9ucycsICgpID0+IHtcclxuICAgIHRlc3QoJ3JlcXVpcmVBZG1pbiBzaG91bGQgc3VjY2VlZCBmb3IgYWRtaW4gdXNlcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYWRtaW5Vc2VyID0ge1xyXG4gICAgICAgIGlkOiAnYWRtaW4tMTIzJyxcclxuICAgICAgICB1c2VybmFtZTogJ2FkbWluJyxcclxuICAgICAgICBiaW86ICcnLFxyXG4gICAgICAgIGxhbmd1YWdlOiAnZnInLFxyXG4gICAgICAgIHRoZW1lOiAnc3lzdGVtJyxcclxuICAgICAgICBhdmF0YXI6ICcnLFxyXG4gICAgICAgIGlzQWRtaW46IHRydWVcclxuICAgICAgfVxyXG5cclxuICAgICAgOyhhdXRoU2VydmljZS5yZXF1aXJlQXV0aCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKGFkbWluVXNlcilcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvUmVzb2x2ZSgoKSA9PiBhdXRoU2VydmljZS5yZXF1aXJlQWRtaW4oKSlcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgncmVxdWlyZUFkbWluIHNob3VsZCB0aHJvdyBlcnJvciBmb3Igbm9uLWFkbWluIHVzZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlZ3VsYXJVc2VyID0ge1xyXG4gICAgICAgIGlkOiAndXNlci0xMjMnLFxyXG4gICAgICAgIHVzZXJuYW1lOiAndXNlcicsXHJcbiAgICAgICAgYmlvOiAnJyxcclxuICAgICAgICBsYW5ndWFnZTogJ2ZyJyxcclxuICAgICAgICB0aGVtZTogJ3N5c3RlbScsXHJcbiAgICAgICAgYXZhdGFyOiAnJyxcclxuICAgICAgICBpc0FkbWluOiBmYWxzZVxyXG4gICAgICB9XHJcblxyXG4gICAgICA7KGF1dGhTZXJ2aWNlLnJlcXVpcmVBdXRoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUocmVndWxhclVzZXIpXHJcblxyXG4gICAgICBhd2FpdCBleHBlY3RUb1Rocm93KFxyXG4gICAgICAgICgpID0+IGF1dGhTZXJ2aWNlLnJlcXVpcmVBZG1pbigpLFxyXG4gICAgICAgICdOb24gYXV0b3Jpc8OpJ1xyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ3JlcXVpcmVBZG1pbiBzaG91bGQgaGFuZGxlIGF1dGhlbnRpY2F0aW9uIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIDsoYXV0aFNlcnZpY2UucmVxdWlyZUF1dGggYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ05vbiBhdXRoZW50aWZpw6knKSlcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UucmVxdWlyZUFkbWluKCksXHJcbiAgICAgICAgJ05vbiBhdXRoZW50aWZpw6knXHJcbiAgICAgIClcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoJ1Nlc3Npb24gQ2xlYW51cCBGdW5jdGlvbnMnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaWduT3V0IHNob3VsZCBkZWxldGUgc2Vzc2lvbiBhbmQgY2xlYXIgY29va2llJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrQ29va2llcyA9IHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB2YWx1ZTogJ3Nlc3Npb24tdG8tZGVsZXRlJyB9KSxcclxuICAgICAgICBkZWxldGU6IGplc3QuZm4oKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBqZXN0LmRvTW9jaygnbmV4dC9oZWFkZXJzJywgKCkgPT4gKHtcclxuICAgICAgICBjb29raWVzOiAoKSA9PiBtb2NrQ29va2llc1xyXG4gICAgICB9KSlcclxuXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLmV4ZWN1dGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpXHJcblxyXG4gICAgICBhd2FpdCBhdXRoU2VydmljZS5zaWduT3V0KClcclxuXHJcbiAgICAgIGV4cGVjdChkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgJ0RFTEVURSBGUk9NIHNlc3Npb25zIFdIRVJFIGlkID0gPycsXHJcbiAgICAgICAgWydzZXNzaW9uLXRvLWRlbGV0ZSddLFxyXG4gICAgICAgICdzaWduT3V0J1xyXG4gICAgICApXHJcbiAgICAgIGV4cGVjdChtb2NrQ29va2llcy5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzZXNzaW9uX2lkJylcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnc2lnbk91dCBzaG91bGQgaGFuZGxlIG1pc3Npbmcgc2Vzc2lvbiBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrQ29va2llcyA9IHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKSxcclxuICAgICAgICBkZWxldGU6IGplc3QuZm4oKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBqZXN0LmRvTW9jaygnbmV4dC9oZWFkZXJzJywgKCkgPT4gKHtcclxuICAgICAgICBjb29raWVzOiAoKSA9PiBtb2NrQ29va2llc1xyXG4gICAgICB9KSlcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvUmVzb2x2ZSgoKSA9PiBhdXRoU2VydmljZS5zaWduT3V0KCkpXHJcblxyXG4gICAgICBleHBlY3QoZGF0YWJhc2VTZXJ2aWNlLmV4ZWN1dGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcclxuICAgICAgZXhwZWN0KG1vY2tDb29raWVzLmRlbGV0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdzaWduT3V0IHNob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrQ29va2llcyA9IHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB2YWx1ZTogJ3Nlc3Npb24taWQnIH0pLFxyXG4gICAgICAgIGRlbGV0ZTogamVzdC5mbigpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGplc3QuZG9Nb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xyXG4gICAgICAgIGNvb2tpZXM6ICgpID0+IG1vY2tDb29raWVzXHJcbiAgICAgIH0pKVxyXG5cclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSlcclxuXHJcbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3csIGJ1dCBoYW5kbGUgZ3JhY2VmdWxseVxyXG4gICAgICBhd2FpdCBleHBlY3RUb1Jlc29sdmUoKCkgPT4gYXV0aFNlcnZpY2Uuc2lnbk91dCgpKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgnVXNlciBTZXNzaW9uIFJldHJpZXZhbCBGdW5jdGlvbnMnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdnZXRTZXNzaW9uVXNlciBzaG91bGQgcmV0dXJuIHVzZXIgZm9yIHZhbGlkIHNlc3Npb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tTZXNzaW9uID0ge1xyXG4gICAgICAgIHNlc3Npb25faWQ6ICd2YWxpZC1zZXNzaW9uJyxcclxuICAgICAgICB1c2VyX2lkOiAndXNlci0xMjMnLFxyXG4gICAgICAgIGV4cGlyZXNfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVzZXJuYW1lOiAndGVzdHVzZXInLFxyXG4gICAgICAgIGJpbzogJ1Rlc3QgYmlvJyxcclxuICAgICAgICBsYW5ndWFnZTogJ2VuJyxcclxuICAgICAgICB0aGVtZTogJ2RhcmsnLFxyXG4gICAgICAgIGF2YXRhcjogJ2F2YXRhci5qcGcnXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHZhbHVlOiAndmFsaWQtc2Vzc2lvbicgfSlcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgamVzdC5kb01vY2soJ25leHQvaGVhZGVycycsICgpID0+ICh7XHJcbiAgICAgICAgY29va2llczogKCkgPT4gbW9ja0Nvb2tpZXNcclxuICAgICAgfSkpXHJcblxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTZXNzaW9uKVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UuZ2V0U2Vzc2lvblVzZXIoKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XHJcbiAgICAgICAgaWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXHJcbiAgICAgICAgYmlvOiAnVGVzdCBiaW8nLFxyXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLFxyXG4gICAgICAgIHRoZW1lOiAnZGFyaycsXHJcbiAgICAgICAgYXZhdGFyOiAnYXZhdGFyLmpwZycsXHJcbiAgICAgICAgaXNBZG1pbjogZmFsc2VcclxuICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnZ2V0U2Vzc2lvblVzZXIgc2hvdWxkIHJldHVybiBudWxsIGZvciBtaXNzaW5nIHNlc3Npb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh1bmRlZmluZWQpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGplc3QuZG9Nb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xyXG4gICAgICAgIGNvb2tpZXM6ICgpID0+IG1vY2tDb29raWVzXHJcbiAgICAgIH0pKVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UuZ2V0U2Vzc2lvblVzZXIoKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdnZXRTZXNzaW9uVXNlciBzaG91bGQgcmV0dXJuIG51bGwgZm9yIGV4cGlyZWQgc2Vzc2lvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXhwaXJlZFNlc3Npb24gPSB7XHJcbiAgICAgICAgc2Vzc2lvbl9pZDogJ2V4cGlyZWQtc2Vzc2lvbicsXHJcbiAgICAgICAgdXNlcl9pZDogJ3VzZXItMTIzJyxcclxuICAgICAgICBleHBpcmVzX2F0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1c2VybmFtZTogJ3Rlc3R1c2VyJ1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBtb2NrQ29va2llcyA9IHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB2YWx1ZTogJ2V4cGlyZWQtc2Vzc2lvbicgfSlcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgamVzdC5kb01vY2soJ25leHQvaGVhZGVycycsICgpID0+ICh7XHJcbiAgICAgICAgY29va2llczogKCkgPT4gbW9ja0Nvb2tpZXNcclxuICAgICAgfSkpXHJcblxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGlyZWRTZXNzaW9uKVxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5leGVjdXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UuZ2V0U2Vzc2lvblVzZXIoKVxyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKVxyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZ5IGNsZWFudXBcclxuICAgICAgZXhwZWN0KGRhdGFiYXNlU2VydmljZS5leGVjdXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAnREVMRVRFIEZST00gc2Vzc2lvbnMgV0hFUkUgaWQgPSA/JyxcclxuICAgICAgICBbJ2V4cGlyZWQtc2Vzc2lvbiddLFxyXG4gICAgICAgICdnZXRTZXNzaW9uVXNlci1jbGVhbnVwJ1xyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ2dldFNlc3Npb25Vc2VyIHNob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHZhbHVlOiAnc2Vzc2lvbi1pZCcgfSlcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgamVzdC5kb01vY2soJ25leHQvaGVhZGVycycsICgpID0+ICh7XHJcbiAgICAgICAgY29va2llczogKCkgPT4gbW9ja0Nvb2tpZXNcclxuICAgICAgfSkpXHJcblxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSlcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLmdldFNlc3Npb25Vc2VyKClcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKClcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoJ0F1ZGl0IExvZ2dpbmcgYW5kIFVzZXIgQWN0aW9uIFRyYWNraW5nJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGxvZyB1c2VyIGNyZWF0aW9uIGV2ZW50cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcclxuICAgICAgOyhhdXRoU2VydmljZS5oYXNoUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoJ2hhc2hlZC1wYXNzd29yZCcpXHJcblxyXG4gICAgICBhd2FpdCBhdXRoU2VydmljZS5jcmVhdGVVc2VyKCduZXd1c2VyJywgJ3Bhc3N3b3JkJylcclxuXHJcbiAgICAgIC8vIFZlcmlmeSBsb2dnaW5nIGNhbGxzIHdlcmUgbWFkZSAoaW1wbGVtZW50YXRpb24gZGVwZW5kcyBvbiBsb2dnaW5nIHNldHVwKVxyXG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5pbmZvKS50b0hhdmVCZWVuQ2FsbGVkKClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGxvZyBhdXRoZW50aWNhdGlvbiBhdHRlbXB0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1VzZXIgPSBjcmVhdGVNb2NrVXNlcigpXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLnF1ZXJ5T25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpXHJcbiAgICAgIDsoYXV0aFNlcnZpY2UuaGFzaFBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tVc2VyLnBhc3N3b3JkX2hhc2gpXHJcblxyXG4gICAgICBhd2FpdCBhdXRoU2VydmljZS52ZXJpZnlDcmVkZW50aWFscygncGFzc3dvcmQnKVxyXG5cclxuICAgICAgLy8gVmVyaWZ5IGF1dGhlbnRpY2F0aW9uIGxvZ2dpbmdcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZCgpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBsb2cgZmFpbGVkIGF1dGhlbnRpY2F0aW9uIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5xdWVyeU9uZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpXHJcblxyXG4gICAgICBhd2FpdCBhdXRoU2VydmljZS52ZXJpZnlDcmVkZW50aWFscygnd3JvbmctcGFzc3dvcmQnKVxyXG5cclxuICAgICAgLy8gVmVyaWZ5IGZhaWxlZCBhdXRoZW50aWNhdGlvbiBsb2dnaW5nXHJcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWQoKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgbG9nIHNlc3Npb24gY3JlYXRpb24gYW5kIGRlc3RydWN0aW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5leGVjdXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKVxyXG5cclxuICAgICAgYXdhaXQgYXV0aFNlcnZpY2UuY3JlYXRlU2Vzc2lvbigndXNlci1pZCcpXHJcblxyXG4gICAgICAvLyBWZXJpZnkgc2Vzc2lvbiBjcmVhdGlvbiBsb2dnaW5nXHJcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWQoKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgdHJhY2sgdXNlciBhY3Rpb25zIHdpdGggY29udGV4dCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1Nlc3Npb24gPSB7XHJcbiAgICAgICAgc2Vzc2lvbl9pZDogJ3Nlc3Npb24tMTIzJyxcclxuICAgICAgICB1c2VyX2lkOiAndXNlci0xMjMnLFxyXG4gICAgICAgIGV4cGlyZXNfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVzZXJuYW1lOiAndGVzdHVzZXInXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG1vY2tDb29raWVzID0ge1xyXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHZhbHVlOiAnc2Vzc2lvbi0xMjMnIH0pXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGplc3QuZG9Nb2NrKCduZXh0L2hlYWRlcnMnLCAoKSA9PiAoe1xyXG4gICAgICAgIGNvb2tpZXM6ICgpID0+IG1vY2tDb29raWVzXHJcbiAgICAgIH0pKVxyXG5cclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UucXVlcnlPbmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU2Vzc2lvbilcclxuXHJcbiAgICAgIGF3YWl0IGF1dGhTZXJ2aWNlLnJlcXVpcmVBdXRoKClcclxuXHJcbiAgICAgIC8vIFZlcmlmeSB1c2VyIGFjdGlvbiB0cmFja2luZyBpbmNsdWRlcyBjb250ZXh0XHJcbiAgICAgIGV4cGVjdChkYXRhYmFzZVNlcnZpY2UucXVlcnlPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdzZXNzaW9ucycpLFxyXG4gICAgICAgIFsnc2Vzc2lvbi0xMjMnXSxcclxuICAgICAgICAncmVxdWlyZUF1dGgnXHJcbiAgICAgIClcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nIGFuZCBFZGdlIENhc2VzJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgc2Vzc2lvbiBkYXRhJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYWxmb3JtZWRTZXNzaW9uID0ge1xyXG4gICAgICAgIHNlc3Npb25faWQ6ICdzZXNzaW9uLTEyMycsXHJcbiAgICAgICAgdXNlcl9pZDogJ3VzZXItMTIzJyxcclxuICAgICAgICBleHBpcmVzX2F0OiAnaW52YWxpZC1kYXRlJyxcclxuICAgICAgICB1c2VybmFtZTogJ3Rlc3R1c2VyJ1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBtb2NrQ29va2llcyA9IHtcclxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB2YWx1ZTogJ3Nlc3Npb24tMTIzJyB9KVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBqZXN0LmRvTW9jaygnbmV4dC9oZWFkZXJzJywgKCkgPT4gKHtcclxuICAgICAgICBjb29raWVzOiAoKSA9PiBtb2NrQ29va2llc1xyXG4gICAgICB9KSlcclxuXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLnF1ZXJ5T25lIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobWFsZm9ybWVkU2Vzc2lvbilcclxuICAgICAgOyhkYXRhYmFzZVNlcnZpY2UuZXhlY3V0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UucmVxdWlyZUF1dGgoKSxcclxuICAgICAgICAnU2Vzc2lvbiBpbnZhbGlkZSdcclxuICAgICAgKVxyXG5cclxuICAgICAgLy8gVmVyaWZ5IGNsZWFudXAgb2YgbWFsZm9ybWVkIHNlc3Npb25cclxuICAgICAgZXhwZWN0KGRhdGFiYXNlU2VydmljZS5leGVjdXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAnREVMRVRFIEZST00gc2Vzc2lvbnMgV0hFUkUgaWQgPSA/JyxcclxuICAgICAgICBbJ3Nlc3Npb24tMTIzJ10sXHJcbiAgICAgICAgJ3JlcXVpcmVBdXRoLWNsZWFudXAnXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHNlc3Npb24gb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJ1xyXG4gICAgICA7KGdlbmVyYXRlSWQgYXMgamVzdC5Nb2NrKVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKCdzZXNzaW9uLTEnKVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKCdzZXNzaW9uLTInKVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKCdzZXNzaW9uLTMnKVxyXG4gICAgICA7KGRhdGFiYXNlU2VydmljZS5leGVjdXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKVxyXG5cclxuICAgICAgLy8gQ3JlYXRlIG11bHRpcGxlIHNlc3Npb25zIGNvbmN1cnJlbnRseVxyXG4gICAgICBjb25zdCBzZXNzaW9uUHJvbWlzZXMgPSBbXHJcbiAgICAgICAgYXV0aFNlcnZpY2UuY3JlYXRlU2Vzc2lvbih1c2VySWQpLFxyXG4gICAgICAgIGF1dGhTZXJ2aWNlLmNyZWF0ZVNlc3Npb24odXNlcklkKSxcclxuICAgICAgICBhdXRoU2VydmljZS5jcmVhdGVTZXNzaW9uKHVzZXJJZClcclxuICAgICAgXVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHNlc3Npb25Qcm9taXNlcylcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0VxdWFsKFsnc2Vzc2lvbi0xJywgJ3Nlc3Npb24tMicsICdzZXNzaW9uLTMnXSlcclxuICAgICAgZXhwZWN0KGRhdGFiYXNlU2VydmljZS5leGVjdXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMylcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBjb25uZWN0aW9uIGZhaWx1cmVzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25FcnJvciA9IG5ldyBFcnJvcignU1FMSVRFX0JVU1k6IGRhdGFiYXNlIGlzIGxvY2tlZCcpXHJcbiAgICAgIDsoZGF0YWJhc2VTZXJ2aWNlLnF1ZXJ5T25lIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoY29ubmVjdGlvbkVycm9yKVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UudmVyaWZ5Q3JlZGVudGlhbHMoJ3Bhc3N3b3JkJylcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIHNlc3Npb24gY29va2llIGZvcm1hdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0Nvb2tpZXMgPSB7XHJcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdmFsdWU6ICcgICAnIH0pIC8vIFdoaXRlc3BhY2Ugb25seVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBqZXN0LmRvTW9jaygnbmV4dC9oZWFkZXJzJywgKCkgPT4gKHtcclxuICAgICAgICBjb29raWVzOiAoKSA9PiBtb2NrQ29va2llc1xyXG4gICAgICB9KSlcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UucmVxdWlyZUF1dGgoKSxcclxuICAgICAgICAnTm9uIGF1dGhlbnRpZmnDqSdcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIG51bGwvdW5kZWZpbmVkIHVzZXIgZGF0YSBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhd2FpdCBleHBlY3RUb1Rocm93KFxyXG4gICAgICAgICgpID0+IGF1dGhTZXJ2aWNlLmNyZWF0ZVVzZXIobnVsbCBhcyBhbnksICdwYXNzd29yZCcpXHJcbiAgICAgIClcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdFRvVGhyb3coXHJcbiAgICAgICAgKCkgPT4gYXV0aFNlcnZpY2UuY3JlYXRlVXNlcigndXNlcm5hbWUnLCBudWxsIGFzIGFueSlcclxuICAgICAgKVxyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0VG9UaHJvdyhcclxuICAgICAgICAoKSA9PiBhdXRoU2VydmljZS5jcmVhdGVTZXNzaW9uKG51bGwgYXMgYW55KVxyXG4gICAgICApXHJcbiAgICB9KVxyXG4gIH0pXHJcbn0pIl0sInZlcnNpb24iOjN9