159127341412d22b696f5a6c3bfe556a
"use strict";
/**
 * Specialized Loggers Tests
 */
Object.defineProperty(exports, "__esModule", { value: true });
const vitest_1 = require("vitest");
const specialized_loggers_1 = require("../specialized-loggers");
// Mock the logger module
vitest_1.vi.mock('../logger', () => ({
    getLogger: vitest_1.vi.fn((context) => ({
        error: vitest_1.vi.fn(),
        warn: vitest_1.vi.fn(),
        info: vitest_1.vi.fn(),
        http: vitest_1.vi.fn(),
        verbose: vitest_1.vi.fn(),
        debug: vitest_1.vi.fn(),
        silly: vitest_1.vi.fn(),
        performance: vitest_1.vi.fn(),
        request: vitest_1.vi.fn(),
        database: vitest_1.vi.fn(),
        userAction: vitest_1.vi.fn()
    }))
}));
(0, vitest_1.describe)('Specialized Loggers', () => {
    (0, vitest_1.beforeEach)(() => {
        vitest_1.vi.clearAllMocks();
    });
    (0, vitest_1.describe)('Pre-configured loggers', () => {
        (0, vitest_1.it)('should provide database logger', () => {
            (0, vitest_1.expect)(specialized_loggers_1.databaseLogger).toBeDefined();
            (0, vitest_1.expect)(typeof specialized_loggers_1.databaseLogger.info).toBe('function');
        });
        (0, vitest_1.it)('should provide API logger', () => {
            (0, vitest_1.expect)(specialized_loggers_1.apiLogger).toBeDefined();
            (0, vitest_1.expect)(typeof specialized_loggers_1.apiLogger.info).toBe('function');
        });
        (0, vitest_1.it)('should provide auth logger', () => {
            (0, vitest_1.expect)(specialized_loggers_1.authLogger).toBeDefined();
            (0, vitest_1.expect)(typeof specialized_loggers_1.authLogger.info).toBe('function');
        });
    });
    (0, vitest_1.describe)('createRequestLogger', () => {
        (0, vitest_1.it)('should create logger with request context', () => {
            const requestLogger = (0, specialized_loggers_1.createRequestLogger)('req-123', 'user-456');
            (0, vitest_1.expect)(requestLogger).toBeDefined();
            (0, vitest_1.expect)(typeof requestLogger.info).toBe('function');
        });
        (0, vitest_1.it)('should include request context in log calls', () => {
            const requestLogger = (0, specialized_loggers_1.createRequestLogger)('req-123', 'user-456');
            requestLogger.info('Test message', { extra: 'data' });
            // The underlying logger should be called with context
            (0, vitest_1.expect)(requestLogger).toBeDefined();
        });
    });
    (0, vitest_1.describe)('PerformanceTimer', () => {
        (0, vitest_1.beforeEach)(() => {
            vitest_1.vi.useFakeTimers();
        });
        (0, vitest_1.afterEach)(() => {
            vitest_1.vi.useRealTimers();
        });
        (0, vitest_1.it)('should measure operation duration', () => {
            const mockLogger = {
                performance: vitest_1.vi.fn(),
                error: vitest_1.vi.fn()
            };
            const timer = new specialized_loggers_1.PerformanceTimer('TEST_OPERATION', mockLogger);
            // Advance time by 1000ms
            vitest_1.vi.advanceTimersByTime(1000);
            const duration = timer.end();
            (0, vitest_1.expect)(duration).toBe(1000);
            (0, vitest_1.expect)(mockLogger.performance).toHaveBeenCalledWith('TEST_OPERATION', 1000, {});
        });
        (0, vitest_1.it)('should end with result', () => {
            const mockLogger = {
                performance: vitest_1.vi.fn(),
                error: vitest_1.vi.fn()
            };
            const timer = new specialized_loggers_1.PerformanceTimer('TEST_OPERATION', mockLogger);
            vitest_1.vi.advanceTimersByTime(500);
            const result = timer.endWithResult('test-result', { extra: 'metadata' });
            (0, vitest_1.expect)(result).toBe('test-result');
            (0, vitest_1.expect)(mockLogger.performance).toHaveBeenCalledWith('TEST_OPERATION', 500, {
                success: true,
                resultType: 'string',
                extra: 'metadata'
            });
        });
        (0, vitest_1.it)('should end with error', () => {
            const mockLogger = {
                performance: vitest_1.vi.fn(),
                error: vitest_1.vi.fn()
            };
            const timer = new specialized_loggers_1.PerformanceTimer('TEST_OPERATION', mockLogger);
            const error = new Error('Test error');
            vitest_1.vi.advanceTimersByTime(750);
            (0, vitest_1.expect)(() => timer.endWithError(error)).toThrow('Test error');
            (0, vitest_1.expect)(mockLogger.error).toHaveBeenCalledWith('TEST_OPERATION failed', error, vitest_1.expect.objectContaining({
                duration: 750,
                success: false
            }));
        });
    });
    (0, vitest_1.describe)('DatabaseQueryLogger', () => {
        (0, vitest_1.it)('should log database queries', () => {
            const mockLogger = {
                database: vitest_1.vi.fn()
            };
            const dbLogger = new specialized_loggers_1.DatabaseQueryLogger(mockLogger);
            dbLogger.logQuery('SELECT * FROM users', ['param1'], 150, { table: 'users' });
            (0, vitest_1.expect)(mockLogger.database).toHaveBeenCalledWith('SELECT * FROM users', 150, {
                params: ['param1'],
                paramCount: 1,
                table: 'users'
            });
        });
        (0, vitest_1.it)('should limit parameters for security', () => {
            const mockLogger = {
                database: vitest_1.vi.fn()
            };
            const dbLogger = new specialized_loggers_1.DatabaseQueryLogger(mockLogger);
            const manyParams = Array.from({ length: 15 }, (_, i) => `param${i}`);
            dbLogger.logQuery('SELECT * FROM users WHERE id IN (?)', manyParams, 200);
            (0, vitest_1.expect)(mockLogger.database).toHaveBeenCalledWith('SELECT * FROM users WHERE id IN (?)', 200, {
                params: manyParams.slice(0, 10),
                paramCount: 15
            });
        });
        (0, vitest_1.it)('should log transactions', () => {
            const mockLogger = {
                performance: vitest_1.vi.fn()
            };
            const dbLogger = new specialized_loggers_1.DatabaseQueryLogger(mockLogger);
            dbLogger.logTransaction('USER_UPDATE', 300, { userId: '123' });
            (0, vitest_1.expect)(mockLogger.performance).toHaveBeenCalledWith('DB_TRANSACTION_USER_UPDATE', 300, {
                type: 'database_transaction',
                userId: '123'
            });
        });
        (0, vitest_1.it)('should log connection events', () => {
            const mockLogger = {
                info: vitest_1.vi.fn(),
                error: vitest_1.vi.fn()
            };
            const dbLogger = new specialized_loggers_1.DatabaseQueryLogger(mockLogger);
            dbLogger.logConnection('connect', { host: 'localhost' });
            (0, vitest_1.expect)(mockLogger.info).toHaveBeenCalledWith('Database connection connect', { host: 'localhost' });
            dbLogger.logConnection('error', { error: 'Connection failed' });
            (0, vitest_1.expect)(mockLogger.error).toHaveBeenCalledWith('Database connection error', undefined, { error: 'Connection failed' });
        });
    });
    (0, vitest_1.describe)('ApiRequestLogger', () => {
        (0, vitest_1.it)('should log API requests', () => {
            const mockLogger = {
                http: vitest_1.vi.fn()
            };
            const apiLogger = new specialized_loggers_1.ApiRequestLogger(mockLogger);
            apiLogger.logRequest('GET', '/api/users', { 'user-agent': 'test' }, { query: 'test' });
            (0, vitest_1.expect)(mockLogger.http).toHaveBeenCalledWith('GET /api/users', {
                method: 'GET',
                url: '/api/users',
                headers: { 'user-agent': 'test' },
                bodySize: vitest_1.expect.any(Number),
                type: 'api_request'
            });
        });
        (0, vitest_1.it)('should sanitize sensitive headers', () => {
            const mockLogger = {
                http: vitest_1.vi.fn()
            };
            const apiLogger = new specialized_loggers_1.ApiRequestLogger(mockLogger);
            apiLogger.logRequest('POST', '/api/login', {
                'authorization': 'Bearer secret-token',
                'cookie': 'session=secret',
                'content-type': 'application/json'
            });
            (0, vitest_1.expect)(mockLogger.http).toHaveBeenCalledWith('POST /api/login', {
                method: 'POST',
                url: '/api/login',
                headers: {
                    'authorization': '[REDACTED]',
                    'cookie': '[REDACTED]',
                    'content-type': 'application/json'
                },
                bodySize: 0,
                type: 'api_request'
            });
        });
        (0, vitest_1.it)('should log API responses', () => {
            const mockLogger = {
                request: vitest_1.vi.fn()
            };
            const apiLogger = new specialized_loggers_1.ApiRequestLogger(mockLogger);
            apiLogger.logResponse('GET', '/api/users', 200, 150, 1024);
            (0, vitest_1.expect)(mockLogger.request).toHaveBeenCalledWith('GET', '/api/users', 200, 150, {
                responseSize: 1024,
                type: 'api_response'
            });
        });
        (0, vitest_1.it)('should log API errors', () => {
            const mockLogger = {
                error: vitest_1.vi.fn()
            };
            const apiLogger = new specialized_loggers_1.ApiRequestLogger(mockLogger);
            const error = new Error('API Error');
            apiLogger.logError('POST', '/api/users', error, 500);
            (0, vitest_1.expect)(mockLogger.error).toHaveBeenCalledWith('POST /api/users failed', error, {
                method: 'POST',
                url: '/api/users',
                duration: 500,
                type: 'api_error'
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRjpcXFlvdWNsb3VkXFxEb2N1bWVudHNcXFByb2pldHNcXExvZ2lzdGl4XFxsaWJcXHV0aWxzXFxsb2dnaW5nXFxfX3Rlc3RzX19cXHNwZWNpYWxpemVkLWxvZ2dlcnMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsbUNBQXlFO0FBQ3pFLGdFQVFnQztBQUVoQyx5QkFBeUI7QUFDekIsV0FBRSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxQixTQUFTLEVBQUUsV0FBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQWUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNyQyxLQUFLLEVBQUUsV0FBRSxDQUFDLEVBQUUsRUFBRTtRQUNkLElBQUksRUFBRSxXQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2IsSUFBSSxFQUFFLFdBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDYixJQUFJLEVBQUUsV0FBRSxDQUFDLEVBQUUsRUFBRTtRQUNiLE9BQU8sRUFBRSxXQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2hCLEtBQUssRUFBRSxXQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2QsS0FBSyxFQUFFLFdBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDZCxXQUFXLEVBQUUsV0FBRSxDQUFDLEVBQUUsRUFBRTtRQUNwQixPQUFPLEVBQUUsV0FBRSxDQUFDLEVBQUUsRUFBRTtRQUNoQixRQUFRLEVBQUUsV0FBRSxDQUFDLEVBQUUsRUFBRTtRQUNqQixVQUFVLEVBQUUsV0FBRSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUEsaUJBQVEsRUFBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBQSxtQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLFdBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNyQixDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsaUJBQVEsRUFBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7UUFDdEMs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QztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkY6XFxZb3VjbG91ZFxcRG9jdW1lbnRzXFxQcm9qZXRzXFxMb2dpc3RpeFxcbGliXFx1dGlsc1xcbG9nZ2luZ1xcX190ZXN0c19fXFxzcGVjaWFsaXplZC1sb2dnZXJzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFNwZWNpYWxpemVkIExvZ2dlcnMgVGVzdHNcclxuICovXHJcblxyXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgdmksIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ3ZpdGVzdCc7XHJcbmltcG9ydCB7XHJcbiAgZGF0YWJhc2VMb2dnZXIsXHJcbiAgYXBpTG9nZ2VyLFxyXG4gIGF1dGhMb2dnZXIsXHJcbiAgY3JlYXRlUmVxdWVzdExvZ2dlcixcclxuICBQZXJmb3JtYW5jZVRpbWVyLFxyXG4gIERhdGFiYXNlUXVlcnlMb2dnZXIsXHJcbiAgQXBpUmVxdWVzdExvZ2dlclxyXG59IGZyb20gJy4uL3NwZWNpYWxpemVkLWxvZ2dlcnMnO1xyXG5cclxuLy8gTW9jayB0aGUgbG9nZ2VyIG1vZHVsZVxyXG52aS5tb2NrKCcuLi9sb2dnZXInLCAoKSA9PiAoe1xyXG4gIGdldExvZ2dlcjogdmkuZm4oKGNvbnRleHQ6IHN0cmluZykgPT4gKHtcclxuICAgIGVycm9yOiB2aS5mbigpLFxyXG4gICAgd2FybjogdmkuZm4oKSxcclxuICAgIGluZm86IHZpLmZuKCksXHJcbiAgICBodHRwOiB2aS5mbigpLFxyXG4gICAgdmVyYm9zZTogdmkuZm4oKSxcclxuICAgIGRlYnVnOiB2aS5mbigpLFxyXG4gICAgc2lsbHk6IHZpLmZuKCksXHJcbiAgICBwZXJmb3JtYW5jZTogdmkuZm4oKSxcclxuICAgIHJlcXVlc3Q6IHZpLmZuKCksXHJcbiAgICBkYXRhYmFzZTogdmkuZm4oKSxcclxuICAgIHVzZXJBY3Rpb246IHZpLmZuKClcclxuICB9KSlcclxufSkpO1xyXG5cclxuZGVzY3JpYmUoJ1NwZWNpYWxpemVkIExvZ2dlcnMnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICB2aS5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQcmUtY29uZmlndXJlZCBsb2dnZXJzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGRhdGFiYXNlIGxvZ2dlcicsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGRhdGFiYXNlTG9nZ2VyKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIGRhdGFiYXNlTG9nZ2VyLmluZm8pLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgQVBJIGxvZ2dlcicsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGFwaUxvZ2dlcikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBhcGlMb2dnZXIuaW5mbykudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBhdXRoIGxvZ2dlcicsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGF1dGhMb2dnZXIpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgYXV0aExvZ2dlci5pbmZvKS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjcmVhdGVSZXF1ZXN0TG9nZ2VyJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgbG9nZ2VyIHdpdGggcmVxdWVzdCBjb250ZXh0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXF1ZXN0TG9nZ2VyID0gY3JlYXRlUmVxdWVzdExvZ2dlcigncmVxLTEyMycsICd1c2VyLTQ1NicpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlcXVlc3RMb2dnZXIpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVxdWVzdExvZ2dlci5pbmZvKS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIHJlcXVlc3QgY29udGV4dCBpbiBsb2cgY2FsbHMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3RMb2dnZXIgPSBjcmVhdGVSZXF1ZXN0TG9nZ2VyKCdyZXEtMTIzJywgJ3VzZXItNDU2Jyk7XHJcbiAgICAgIFxyXG4gICAgICByZXF1ZXN0TG9nZ2VyLmluZm8oJ1Rlc3QgbWVzc2FnZScsIHsgZXh0cmE6ICdkYXRhJyB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFRoZSB1bmRlcmx5aW5nIGxvZ2dlciBzaG91bGQgYmUgY2FsbGVkIHdpdGggY29udGV4dFxyXG4gICAgICBleHBlY3QocmVxdWVzdExvZ2dlcikudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2VUaW1lcicsICgpID0+IHtcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICB2aS51c2VGYWtlVGltZXJzKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgICB2aS51c2VSZWFsVGltZXJzKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG1lYXN1cmUgb3BlcmF0aW9uIGR1cmF0aW9uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTG9nZ2VyID0ge1xyXG4gICAgICAgIHBlcmZvcm1hbmNlOiB2aS5mbigpLFxyXG4gICAgICAgIGVycm9yOiB2aS5mbigpXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgdGltZXIgPSBuZXcgUGVyZm9ybWFuY2VUaW1lcignVEVTVF9PUEVSQVRJT04nLCBtb2NrTG9nZ2VyKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFkdmFuY2UgdGltZSBieSAxMDAwbXNcclxuICAgICAgdmkuYWR2YW5jZVRpbWVyc0J5VGltZSgxMDAwKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGltZXIuZW5kKCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmUoMTAwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLnBlcmZvcm1hbmNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVEVTVF9PUEVSQVRJT04nLCAxMDAwLCB7fSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGVuZCB3aXRoIHJlc3VsdCcsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0xvZ2dlciA9IHtcclxuICAgICAgICBwZXJmb3JtYW5jZTogdmkuZm4oKSxcclxuICAgICAgICBlcnJvcjogdmkuZm4oKVxyXG4gICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgIGNvbnN0IHRpbWVyID0gbmV3IFBlcmZvcm1hbmNlVGltZXIoJ1RFU1RfT1BFUkFUSU9OJywgbW9ja0xvZ2dlcik7XHJcbiAgICAgIFxyXG4gICAgICB2aS5hZHZhbmNlVGltZXJzQnlUaW1lKDUwMCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSB0aW1lci5lbmRXaXRoUmVzdWx0KCd0ZXN0LXJlc3VsdCcsIHsgZXh0cmE6ICdtZXRhZGF0YScgfSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCd0ZXN0LXJlc3VsdCcpO1xyXG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5wZXJmb3JtYW5jZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1RFU1RfT1BFUkFUSU9OJywgNTAwLCB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICByZXN1bHRUeXBlOiAnc3RyaW5nJyxcclxuICAgICAgICBleHRyYTogJ21ldGFkYXRhJ1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZW5kIHdpdGggZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tMb2dnZXIgPSB7XHJcbiAgICAgICAgcGVyZm9ybWFuY2U6IHZpLmZuKCksXHJcbiAgICAgICAgZXJyb3I6IHZpLmZuKClcclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBjb25zdCB0aW1lciA9IG5ldyBQZXJmb3JtYW5jZVRpbWVyKCdURVNUX09QRVJBVElPTicsIG1vY2tMb2dnZXIpO1xyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG4gICAgICBcclxuICAgICAgdmkuYWR2YW5jZVRpbWVyc0J5VGltZSg3NTApO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KCgpID0+IHRpbWVyLmVuZFdpdGhFcnJvcihlcnJvcikpLnRvVGhyb3coJ1Rlc3QgZXJyb3InKTtcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICdURVNUX09QRVJBVElPTiBmYWlsZWQnLFxyXG4gICAgICAgIGVycm9yLFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIGR1cmF0aW9uOiA3NTAsXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZVxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0RhdGFiYXNlUXVlcnlMb2dnZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGxvZyBkYXRhYmFzZSBxdWVyaWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTG9nZ2VyID0ge1xyXG4gICAgICAgIGRhdGFiYXNlOiB2aS5mbigpXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgZGJMb2dnZXIgPSBuZXcgRGF0YWJhc2VRdWVyeUxvZ2dlcihtb2NrTG9nZ2VyKTtcclxuICAgICAgXHJcbiAgICAgIGRiTG9nZ2VyLmxvZ1F1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHVzZXJzJywgWydwYXJhbTEnXSwgMTUwLCB7IHRhYmxlOiAndXNlcnMnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuZGF0YWJhc2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTRUxFQ1QgKiBGUk9NIHVzZXJzJywgMTUwLCB7XHJcbiAgICAgICAgcGFyYW1zOiBbJ3BhcmFtMSddLFxyXG4gICAgICAgIHBhcmFtQ291bnQ6IDEsXHJcbiAgICAgICAgdGFibGU6ICd1c2VycydcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGxpbWl0IHBhcmFtZXRlcnMgZm9yIHNlY3VyaXR5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTG9nZ2VyID0ge1xyXG4gICAgICAgIGRhdGFiYXNlOiB2aS5mbigpXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgZGJMb2dnZXIgPSBuZXcgRGF0YWJhc2VRdWVyeUxvZ2dlcihtb2NrTG9nZ2VyKTtcclxuICAgICAgY29uc3QgbWFueVBhcmFtcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDE1IH0sIChfLCBpKSA9PiBgcGFyYW0ke2l9YCk7XHJcbiAgICAgIFxyXG4gICAgICBkYkxvZ2dlci5sb2dRdWVyeSgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBpZCBJTiAoPyknLCBtYW55UGFyYW1zLCAyMDApO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuZGF0YWJhc2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICdTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGlkIElOICg/KScsXHJcbiAgICAgICAgMjAwLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHBhcmFtczogbWFueVBhcmFtcy5zbGljZSgwLCAxMCksXHJcbiAgICAgICAgICBwYXJhbUNvdW50OiAxNVxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbG9nIHRyYW5zYWN0aW9ucycsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0xvZ2dlciA9IHtcclxuICAgICAgICBwZXJmb3JtYW5jZTogdmkuZm4oKVxyXG4gICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgIGNvbnN0IGRiTG9nZ2VyID0gbmV3IERhdGFiYXNlUXVlcnlMb2dnZXIobW9ja0xvZ2dlcik7XHJcbiAgICAgIFxyXG4gICAgICBkYkxvZ2dlci5sb2dUcmFuc2FjdGlvbignVVNFUl9VUERBVEUnLCAzMDAsIHsgdXNlcklkOiAnMTIzJyB9KTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLnBlcmZvcm1hbmNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnREJfVFJBTlNBQ1RJT05fVVNFUl9VUERBVEUnLCAzMDAsIHtcclxuICAgICAgICB0eXBlOiAnZGF0YWJhc2VfdHJhbnNhY3Rpb24nLFxyXG4gICAgICAgIHVzZXJJZDogJzEyMydcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGxvZyBjb25uZWN0aW9uIGV2ZW50cycsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0xvZ2dlciA9IHtcclxuICAgICAgICBpbmZvOiB2aS5mbigpLFxyXG4gICAgICAgIGVycm9yOiB2aS5mbigpXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgZGJMb2dnZXIgPSBuZXcgRGF0YWJhc2VRdWVyeUxvZ2dlcihtb2NrTG9nZ2VyKTtcclxuICAgICAgXHJcbiAgICAgIGRiTG9nZ2VyLmxvZ0Nvbm5lY3Rpb24oJ2Nvbm5lY3QnLCB7IGhvc3Q6ICdsb2NhbGhvc3QnIH0pO1xyXG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5pbmZvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnRGF0YWJhc2UgY29ubmVjdGlvbiBjb25uZWN0JywgeyBob3N0OiAnbG9jYWxob3N0JyB9KTtcclxuICAgICAgXHJcbiAgICAgIGRiTG9nZ2VyLmxvZ0Nvbm5lY3Rpb24oJ2Vycm9yJywgeyBlcnJvcjogJ0Nvbm5lY3Rpb24gZmFpbGVkJyB9KTtcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yJywgdW5kZWZpbmVkLCB7IGVycm9yOiAnQ29ubmVjdGlvbiBmYWlsZWQnIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdBcGlSZXF1ZXN0TG9nZ2VyJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBsb2cgQVBJIHJlcXVlc3RzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTG9nZ2VyID0ge1xyXG4gICAgICAgIGh0dHA6IHZpLmZuKClcclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBjb25zdCBhcGlMb2dnZXIgPSBuZXcgQXBpUmVxdWVzdExvZ2dlcihtb2NrTG9nZ2VyKTtcclxuICAgICAgXHJcbiAgICAgIGFwaUxvZ2dlci5sb2dSZXF1ZXN0KCdHRVQnLCAnL2FwaS91c2VycycsIHsgJ3VzZXItYWdlbnQnOiAndGVzdCcgfSwgeyBxdWVyeTogJ3Rlc3QnIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaHR0cCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0dFVCAvYXBpL3VzZXJzJywge1xyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgdXJsOiAnL2FwaS91c2VycycsXHJcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0JyB9LFxyXG4gICAgICAgIGJvZHlTaXplOiBleHBlY3QuYW55KE51bWJlciksXHJcbiAgICAgICAgdHlwZTogJ2FwaV9yZXF1ZXN0J1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgc2Vuc2l0aXZlIGhlYWRlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tMb2dnZXIgPSB7XHJcbiAgICAgICAgaHR0cDogdmkuZm4oKVxyXG4gICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgIGNvbnN0IGFwaUxvZ2dlciA9IG5ldyBBcGlSZXF1ZXN0TG9nZ2VyKG1vY2tMb2dnZXIpO1xyXG4gICAgICBcclxuICAgICAgYXBpTG9nZ2VyLmxvZ1JlcXVlc3QoJ1BPU1QnLCAnL2FwaS9sb2dpbicsIHtcclxuICAgICAgICAnYXV0aG9yaXphdGlvbic6ICdCZWFyZXIgc2VjcmV0LXRva2VuJyxcclxuICAgICAgICAnY29va2llJzogJ3Nlc3Npb249c2VjcmV0JyxcclxuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaHR0cCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1BPU1QgL2FwaS9sb2dpbicsIHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICB1cmw6ICcvYXBpL2xvZ2luJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnYXV0aG9yaXphdGlvbic6ICdbUkVEQUNURURdJyxcclxuICAgICAgICAgICdjb29raWUnOiAnW1JFREFDVEVEXScsXHJcbiAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5U2l6ZTogMCxcclxuICAgICAgICB0eXBlOiAnYXBpX3JlcXVlc3QnXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBsb2cgQVBJIHJlc3BvbnNlcycsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0xvZ2dlciA9IHtcclxuICAgICAgICByZXF1ZXN0OiB2aS5mbigpXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgYXBpTG9nZ2VyID0gbmV3IEFwaVJlcXVlc3RMb2dnZXIobW9ja0xvZ2dlcik7XHJcbiAgICAgIFxyXG4gICAgICBhcGlMb2dnZXIubG9nUmVzcG9uc2UoJ0dFVCcsICcvYXBpL3VzZXJzJywgMjAwLCAxNTAsIDEwMjQpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0dFVCcsICcvYXBpL3VzZXJzJywgMjAwLCAxNTAsIHtcclxuICAgICAgICByZXNwb25zZVNpemU6IDEwMjQsXHJcbiAgICAgICAgdHlwZTogJ2FwaV9yZXNwb25zZSdcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGxvZyBBUEkgZXJyb3JzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTG9nZ2VyID0ge1xyXG4gICAgICAgIGVycm9yOiB2aS5mbigpXHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgYXBpTG9nZ2VyID0gbmV3IEFwaVJlcXVlc3RMb2dnZXIobW9ja0xvZ2dlcik7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdBUEkgRXJyb3InKTtcclxuICAgICAgXHJcbiAgICAgIGFwaUxvZ2dlci5sb2dFcnJvcignUE9TVCcsICcvYXBpL3VzZXJzJywgZXJyb3IsIDUwMCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1BPU1QgL2FwaS91c2VycyBmYWlsZWQnLCBlcnJvciwge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIHVybDogJy9hcGkvdXNlcnMnLFxyXG4gICAgICAgIGR1cmF0aW9uOiA1MDAsXHJcbiAgICAgICAgdHlwZTogJ2FwaV9lcnJvcidcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9